<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>十二时辰日记 - 时间管理</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f0f9f0 0%, #e6f7e6 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 15px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.05);
        }
        
        h1 {
            color: #2e7d32;
            font-size: 1.8rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .tagline {
            font-size: 0.95rem;
            color: #4caf50;
            font-style: italic;
            margin-bottom: 8px;
        }
        
        .current-date {
            font-size: 1rem;
            color: #666;
            background: #e8f5e9;
            padding: 6px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 5px;
        }
        
        /* 滑动界面容器 */
        .swipe-container {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            height: 500px;
            background: white;
        }
        
        .swipe-wrapper {
            display: flex;
            width: 400%;
            height: 100%;
            transition: transform 0.4s ease;
        }
        
        .swipe-panel {
            width: 25%;
            height: 100%;
            padding: 20px;
            overflow-y: auto;
        }
        
        .swipe-panel h2 {
            color: #2e7d32;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e8f5e9;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.3rem;
        }
        
        .swipe-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 12px;
        }
        
        .swipe-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #c8e6c9;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .swipe-dot.active {
            background: #4caf50;
            transform: scale(1.2);
        }
        
        .swipe-nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .swipe-btn {
            padding: 8px 15px;
            background: #4caf50;
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .swipe-btn:hover {
            background: #388e3c;
            transform: translateY(-2px);
        }
        
        .swipe-btn.prev {
            background: #81c784;
        }
        
        .swipe-btn.prev:hover {
            background: #66bb6a;
        }
        
        /* 左侧紫微斗数十二宫布局 */
        .palace-section {
            height: fit-content;
        }
        
        .palace-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10px;
        }
        
        .palace-cell {
            aspect-ratio: 1/1;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            text-align: center;
            position: relative;
        }
        
        .palace-cell:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(76, 175, 80, 0.2);
        }
        
        .palace-cell.active {
            background: #e8f5e9;
            border-color: #4caf50;
            transform: scale(1.05);
            z-index: 10;
        }
        
        .palace-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: #2e7d32;
            margin-bottom: 3px;
        }
        
        .palace-time {
            font-size: 0.75rem;
            color: #81c784;
            margin-bottom: 8px;
        }
        
        .palace-status {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: center;
            margin-top: 3px;
        }
        
        .status-icon {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
        }
        
        .mood-优 { background: #43a047; color: white; }
        .mood-良 { background: #66bb6a; color: white; }
        .mood-中 { background: #f1c40f; color: black; }
        .mood-差 { background: #e74c3c; color: white; }
        
        .energy-优 { background: #4caf50; color: white; }
        .energy-良 { background: #66bb6a; color: white; }
        .energy-中 { background: #81c784; color: white; }
        .energy-差 { background: #a5d6a7; color: white; }
        
        .action-icon {
            font-size: 1rem;
            margin-top: 3px;
        }
        
        .action-sleep { color: #81c784; }
        .action-growth { color: #43a047; }
        .action-waste { color: #f39c12; }
        .action-other { color: #e74c3c; }
        
        .palace-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .palace-btn {
            padding: 8px 15px;
            background: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 6px;
            color: #2e7d32;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
        }
        
        .palace-btn:hover {
            background: #4caf50;
            color: white;
        }
        
        /* 右侧记录区域 - 第一个面板 */
        .record-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .period-record {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
        }
        
        .period-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8f5e9;
        }
        
        .period-title {
            color: #2e7d32;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .period-subtitle {
            color: #81c784;
            font-size: 0.9rem;
        }
        
        .record-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .form-group label {
            font-weight: 600;
            color: #2e7d32;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
        }
        
        .form-group textarea {
            width: 100%;
            height: 100px;
            border: 1px solid #c8e6c9;
            border-radius: 8px;
            padding: 12px;
            font-size: 0.9rem;
            resize: vertical;
            transition: border 0.3s;
        }
        
        .form-group textarea:focus {
            outline: none;
            border-color: #4caf50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        .form-group select {
            padding: 10px 12px;
            border: 1px solid #c8e6c9;
            border-radius: 8px;
            background: white;
            color: #333;
            font-size: 0.9rem;
            transition: border 0.3s;
        }
        
        .form-group select:focus {
            outline: none;
            border-color: #4caf50;
        }
        
        .action-buttons-small {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }
        
        .action-btn-small {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
        }
        
        .save-period-btn {
            background: #4caf50;
            color: white;
        }
        
        .clear-period-btn {
            background: #f5f5f5;
            color: #666;
            border: 1px solid #ddd;
        }
        
        .action-btn-small:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
        }
        
        /* 知易行难编辑器 */
        .editor-container {
            border: 1px solid #c8e6c9;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .editor-toolbar {
            display: flex;
            padding: 8px;
            background: #f8f9fa;
            border-bottom: 1px solid #c8e6c9;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .editor-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #c8e6c9;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 0.8rem;
        }
        
        .editor-btn:hover {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        
        .editor-btn.active {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }
        
        .editor-content {
            min-height: 120px;
            padding: 12px;
            font-size: 0.9rem;
            line-height: 1.5;
            outline: none;
            overflow-y: auto;
            color: #333;
        }
        
        .editor-content[data-placeholder]:empty:before {
            content: attr(data-placeholder);
            color: #999;
        }
        
        .editor-content ul, .editor-content ol {
            padding-left: 20px;
            margin: 8px 0;
        }
        
        .editor-content li {
            margin-bottom: 4px;
        }
        
        .editor-content .lined {
            text-decoration: line-through;
            opacity: 0.7;
            background-color: #f0f0f0;
        }
        
        .editor-content .highlighted {
            background-color: #e8f5e9;
            padding: 0 2px;
            border-radius: 3px;
        }
        
        .editor-content .task-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 6px;
            padding: 2px 0;
            min-height: 24px;
        }
        
        .editor-content .task-checkbox {
            margin-right: 8px;
            margin-top: 3px;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .editor-content .task-content {
            flex: 1;
            min-height: 1.2em;
            outline: none;
        }
        
        .editor-content .task-checkbox:checked + .task-content {
            text-decoration: line-through;
            opacity: 0.7;
            background-color: #f0f0f0;
        }
        
        /* 防止编辑器内容为空时显示不正常 */
        .editor-content:empty::before {
            content: none !important;
        }
        
        /* 每日总结区域 */
        .daily-summary {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
        }
        
        .daily-summary h2 {
            color: #2e7d32;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.3rem;
        }
        
        #summaryText {
            width: 100%;
            height: 120px;
            border: 1px solid #c8e6c9;
            border-radius: 8px;
            padding: 12px;
            font-size: 0.9rem;
            resize: vertical;
            transition: border 0.3s;
        }
        
        #summaryText:focus {
            outline: none;
            border-color: #4caf50;
        }
        
        /* 番茄钟面板 - 第二个面板 */
        .pomodoro-section {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .pomodoro-timer {
            text-align: center;
            margin-bottom: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        #timerDisplay {
            font-size: 3.5rem;
            font-weight: bold;
            color: #4caf50;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }
        
        .pomodoro-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .pomodoro-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 40px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #startBtn {
            background: #43a047;
            color: white;
        }
        
        #pauseBtn {
            background: #f39c12;
            color: white;
        }
        
        #resetBtn {
            background: #e74c3c;
            color: white;
        }
        
        .pomodoro-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }
        
        .pomodoro-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e8f5e9;
            font-size: 0.9rem;
        }
        
        .tomato-count {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }
        
        .tomato-icon {
            color: #e74c3c;
            font-size: 1.2rem;
        }
        
        .pomodoro-settings {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .time-setting {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .time-setting input {
            width: 60px;
            padding: 8px;
            border: 1px solid #c8e6c9;
            border-radius: 6px;
            text-align: center;
            font-size: 0.9rem;
        }
        
        /* 数据分析面板 - 第三个面板 */
        .trends-section {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .trends-tabs {
            display: flex;
            border-bottom: 2px solid #e8f5e9;
            margin-bottom: 15px;
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: #81c784;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: 0.9rem;
        }
        
        .tab-btn.active {
            color: #4caf50;
            border-bottom-color: #4caf50;
        }
        
        .tab-btn:hover:not(.active) {
            color: #2e7d32;
        }
        
        .tab-content {
            display: none;
            flex-grow: 1;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }
        
        .trends-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .trend-btn {
            padding: 8px 15px;
            background: #e8f5e9;
            border: none;
            border-radius: 6px;
            color: #4caf50;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }
        
        .trend-btn.active {
            background: #4caf50;
            color: white;
        }
        
        .trend-btn:hover:not(.active) {
            background: #c8e6c9;
        }
        
        .chart-container {
            height: 250px;
            position: relative;
            margin-bottom: 15px;
        }
        
        /* 日历样式 */
        .calendar {
            margin-top: 15px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .calendar-nav-btn {
            background: #e8f5e9;
            border: none;
            border-radius: 6px;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .calendar-nav-btn:hover {
            background: #c8e6c9;
        }
        
        .calendar-current {
            font-weight: 600;
            font-size: 1rem;
            color: #2e7d32;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        
        .calendar-day-header {
            text-align: center;
            padding: 8px;
            font-weight: 600;
            color: #81c784;
            background: #e8f5e9;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        
        .calendar-day {
            aspect-ratio: 1/1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            padding: 4px;
            position: relative;
            border: 2px solid transparent;
            font-size: 0.85rem;
        }
        
        .calendar-day:hover {
            background: #e8f5e9;
        }
        
        .calendar-day.current {
            border-color: #4caf50;
            background: #e8f5e9;
        }
        
        .calendar-day.has-data {
            background: #e8f5e9;
        }
        
        .calendar-day.active-date {
            border-color: #ff9800;
            background: #fff3e0;
        }
        
        .day-number {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .day-indicators {
            display: flex;
            gap: 2px;
        }
        
        .day-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }
        
        .day-tomato {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.7rem;
            color: #e74c3c;
        }
        
        .history-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        #historyDate {
            padding: 8px;
            border: 1px solid #c8e6c9;
            border-radius: 6px;
            background: white;
            font-size: 0.9rem;
        }
        
        #loadHistoryBtn {
            padding: 8px 15px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 0.9rem;
        }
        
        #loadHistoryBtn:hover {
            background: #388e3c;
        }
        
        .stats-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .stats-container .form-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .stats-container h3 {
            color: #2e7d32;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
        }
        
        #monthStats {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            height: 250px;
            overflow-y: auto;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e8f5e9;
            font-size: 0.9rem;
        }
        
        .stat-label {
            font-weight: 600;
            color: #2e7d32;
        }
        
        .stat-value {
            color: #4caf50;
            font-weight: 600;
        }
        
        /* 云端设置面板 - 第四个面板 */
        .cloud-section {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .cloud-settings {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .cloud-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e8f5e9;
        }
        
        .cloud-status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e74c3c;
        }
        
        .status-dot.connected {
            background: #4caf50;
            animation: pulse 2s infinite;
        }
        
        .status-dot.syncing {
            background: #f39c12;
            animation: pulse 1s infinite;
        }
        
        .cloud-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .cloud-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .cloud-btn.primary {
            background: #4caf50;
            color: white;
        }
        
        .cloud-btn.secondary {
            background: #2196f3;
            color: white;
        }
        
        .cloud-btn.warning {
            background: #f39c12;
            color: white;
        }
        
        .cloud-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }
        
        .cloud-form {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .cloud-form h3 {
            color: #2e7d32;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .cloud-form input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #c8e6c9;
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .cloud-form input:focus {
            outline: none;
            border-color: #4caf50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        .cloud-help {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 12px;
            border-radius: 4px;
            margin-top: 15px;
            font-size: 0.85rem;
        }
        
        .cloud-help h4 {
            color: #2e7d32;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .cloud-help ul {
            padding-left: 20px;
        }
        
        .cloud-help li {
            margin-bottom: 5px;
            line-height: 1.4;
        }
        
        .cloud-help code {
            background: #f1f8e9;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.8rem;
        }
        
        .cloud-log {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .cloud-log h3 {
            color: #2e7d32;
            margin-bottom: 10px;
            font-family: inherit;
            font-size: 0.9rem;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #e8f5e9;
        }
        
        .log-entry.success {
            color: #4caf50;
        }
        
        .log-entry.error {
            color: #e74c3c;
        }
        
        .log-entry.info {
            color: #2196f3;
        }
        
        .log-time {
            color: #999;
            margin-right: 10px;
        }
        
        /* 数据导入导出区域 */
        .import-export-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
            margin-top: 20px;
        }
        
        .import-export-section h2 {
            color: #2e7d32;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.3rem;
        }
        
        .data-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .import-export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .data-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .export-btn {
            background: #4caf50;
            color: white;
        }
        
        .import-btn {
            background: #2196f3;
            color: white;
        }
        
        .clear-all-btn {
            background: #f44336;
            color: white;
        }
        
        .data-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }
        
        .import-instructions {
            background: #f8f9fa;
            border-left: 4px solid #4caf50;
            padding: 12px;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        
        .import-instructions h4 {
            color: #2e7d32;
            margin-bottom: 5px;
        }
        
        .import-instructions ul {
            padding-left: 20px;
        }
        
        .import-instructions li {
            margin-bottom: 3px;
        }
        
        /* 底部操作按钮 */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        #saveBtn {
            background: #4caf50;
            color: white;
        }
        
        #clearBtn {
            background: #f5f5f5;
            color: #666;
            border: 1px solid #ddd;
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.08);
        }
        
        /* 响应式调整 - 平板 */
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .tagline {
                font-size: 1rem;
            }
            
            .current-date {
                font-size: 1.1rem;
                padding: 8px 20px;
            }
            
            .swipe-container {
                height: 600px;
            }
            
            .swipe-panel {
                padding: 25px;
            }
            
            .swipe-panel h2 {
                font-size: 1.5rem;
            }
            
            .palace-grid {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: repeat(3, 1fr);
                gap: 15px;
            }
            
            .palace-name {
                font-size: 1.3rem;
            }
            
            .form-row {
                grid-template-columns: 1fr 1fr;
            }
            
            #timerDisplay {
                font-size: 4.5rem;
            }
            
            .pomodoro-controls {
                flex-wrap: nowrap;
            }
            
            .calendar-grid {
                gap: 5px;
            }
            
            .calendar-day-header, .calendar-day {
                font-size: 0.9rem;
                padding: 5px;
            }
            
            .stats-container .form-row {
                grid-template-columns: 1fr 1fr;
            }
            
            .cloud-controls {
                flex-direction: row;
                justify-content: flex-start;
            }
            
            .cloud-form .form-row {
                grid-template-columns: 1fr 1fr;
            }
            
            .data-controls {
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-start;
            }
            
            .import-export-buttons {
                flex-direction: column;
            }
            
            .import-instructions {
                flex: 1;
                margin-left: 20px;
            }
        }
        
        /* 响应式调整 - 桌面 */
        @media (min-width: 1024px) {
            .palace-grid {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: repeat(3, 1fr);
                gap: 15px;
            }
            
            .palace-name {
                font-size: 1.4rem;
            }
            
            .swipe-container {
                height: 700px;
            }
            
            #timerDisplay {
                font-size: 5rem;
            }
            
            .action-buttons {
                flex-direction: row;
            }
            
            .action-btn {
                justify-content: center;
            }
            
            .import-export-buttons {
                flex-direction: row;
            }
            
            .cloud-form .form-row {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .period-record, .daily-summary, .pomodoro-section, .trends-section, .palace-section, .import-export-section, .cloud-section {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .palace-cell.active {
            animation: pulse 2s infinite;
        }
        
        /* 紫微斗数颜色主题 - 绿色系 */
        .palace-0 { background: linear-gradient(135deg, #f8f9fa 0%, #e6f7e6 100%); }
        .palace-1 { background: linear-gradient(135deg, #f8f9fa 0%, #e6f7ec 100%); }
        .palace-2 { background: linear-gradient(135deg, #f8f9fa 0%, #e6f7f2 100%); }
        .palace-3 { background: linear-gradient(135deg, #f8f9fa 0%, #e6f7f7 100%); }
        .palace-4 { background: linear-gradient(135deg, #f8f9fa 0%, #e6f2f7 100%); }
        .palace-5 { background: linear-gradient(135deg, #f8f9fa 0%, #e6ecf7 100%); }
        .palace-6 { background: linear-gradient(135deg, #f8f9fa 0%, #e6e6f7 100%); }
        .palace-7 { background: linear-gradient(135deg, #f8f9fa 0%, #ece6f7 100%); }
        .palace-8 { background: linear-gradient(135deg, #f8f9fa 0%, #f2e6f7 100%); }
        .palace-9 { background: linear-gradient(135deg, #f8f9fa 0%, #f7e6f7 100%); }
        .palace-10 { background: linear-gradient(135deg, #f8f9fa 0%, #f7e6f2 100%); }
        .palace-11 { background: linear-gradient(135deg, #f8f9fa 0%, #f7e6ec 100%); }
        
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c8e6c9;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a5d6a7;
        }
        
        /* 移动端优化 */
        @media (max-width: 480px) {
            .swipe-container {
                height: 450px;
            }
            
            .swipe-panel {
                padding: 15px;
            }
            
            .palace-grid {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(4, 1fr);
                gap: 8px;
            }
            
            .palace-name {
                font-size: 1rem;
            }
            
            .palace-time {
                font-size: 0.7rem;
            }
            
            .status-icon {
                width: 16px;
                height: 16px;
                font-size: 0.6rem;
            }
            
            #timerDisplay {
                font-size: 2.8rem;
            }
            
            .pomodoro-btn {
                padding: 8px 15px;
                font-size: 0.8rem;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .action-btn {
                width: 100%;
                justify-content: center;
                padding: 10px 20px;
            }
            
            .trends-tabs {
                font-size: 0.8rem;
            }
            
            .tab-btn {
                padding: 8px 12px;
            }
            
            .trend-btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            .calendar-day-header {
                padding: 6px;
                font-size: 0.8rem;
            }
            
            .calendar-day {
                padding: 3px;
                font-size: 0.8rem;
            }
            
            .day-number {
                font-size: 0.8rem;
            }
            
            .data-btn {
                width: 100%;
                justify-content: center;
            }
            
            .cloud-btn {
                width: 100%;
                justify-content: center;
            }
            
            .import-export-buttons {
                flex-direction: column;
            }
        }
        
        /* 非常小的屏幕 */
        @media (max-width: 360px) {
            h1 {
                font-size: 1.5rem;
            }
            
            .palace-grid {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(6, 1fr);
            }
            
            .swipe-container {
                height: 400px;
            }
            
            .swipe-panel {
                padding: 10px;
            }
        }
        
        /* 通知样式 */
        .notification {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 12px 20px;
            background: #4caf50;
            color: white;
            border-radius: 6px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
            z-index: 1000;
            animation: fadeIn 0.3s;
            font-size: 0.9rem;
            max-width: 300px;
        }
        
        .notification.success {
            background: #4caf50;
        }
        
        .notification.error {
            background: #e74c3c;
        }
        
        .notification.info {
            background: #f39c12;
        }
        
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-15px); }
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }
        
        .highlight {
            animation: pulse 1s ease-in-out;
        }
        
        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8f5e9;
        }
        
        .modal-title {
            color: #2e7d32;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .modal-close:hover {
            color: #e74c3c;
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-book-open"></i> 十二时辰日记</h1>
            <p class="tagline">知易行难 · 记录时间中的成长</p>
            <div class="current-date" id="currentDate">加载中...</div>
        </header>
        
        <!-- 滑动界面容器 -->
        <div class="swipe-container">
            <div class="swipe-wrapper" id="swipeWrapper">
                <!-- 第一个面板：日记记录 -->
                <div class="swipe-panel" id="panel1">
                    <div class="main-content" style="display: grid; grid-template-columns: 1fr; gap: 20px;">
                        <!-- 左侧十二时辰宫格 -->
                        <section class="palace-section">
                            <h2><i class="fas fa-chess-board"></i> 十二时辰宫格</h2>
                            <div class="palace-grid" id="palaceGrid">
                                <!-- 时辰宫格将通过JavaScript动态生成 -->
                            </div>
                            <div class="palace-controls">
                                <button class="palace-btn" id="prevPeriodBtn">
                                    <i class="fas fa-chevron-left"></i> 上一时辰
                                </button>
                                <button class="palace-btn" id="nextPeriodBtn">
                                    下一时辰 <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </section>
                        
                        <!-- 右侧记录区域 -->
                        <section class="record-section">
                            <section class="period-record">
                                <div class="period-header">
                                    <div>
                                        <div class="period-title">
                                            <i class="fas fa-clock"></i>
                                            <span id="selectedPeriodName">子时</span>
                                        </div>
                                        <div class="period-subtitle" id="selectedPeriodTime">23:00 - 01:00</div>
                                    </div>
                                    <div id="periodStatus" class="period-status">
                                        <span class="status-indicator" style="background:#4caf50;"></span>
                                        已记录
                                    </div>
                                </div>
                                
                                <div class="record-form">
                                    <div class="form-group">
                                        <label for="actionType"><i class="fas fa-running"></i> 做了</label>
                                        <select id="actionType">
                                            <option value="">选择所做之事</option>
                                            <option value="sleep">睡觉</option>
                                            <option value="growth">成长</option>
                                            <option value="waste">浪费</option>
                                            <option value="other">其他</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="knowledgeText"><i class="fas fa-brain"></i> 知易（本时辰所做的事）</label>
                                            <div class="editor-container">
                                                <div class="editor-toolbar" id="knowledgeToolbar">
                                                    <button class="editor-btn" data-command="insertOrderedList" title="有序列表"><i class="fas fa-list-ol"></i></button>
                                                    <button class="editor-btn" data-command="insertUnorderedList" title="无序列表"><i class="fas fa-list-ul"></i></button>
                                                    <button class="editor-btn" data-command="addCheckbox" title="添加任务复选框"><i class="far fa-check-square"></i></button>
                                                    <button class="editor-btn" data-command="highlight" title="高亮"><i class="fas fa-highlighter"></i></button>
                                                    <button class="editor-btn" data-command="clearFormat" title="清除格式"><i class="fas fa-eraser"></i></button>
                                                </div>
                                                <div class="editor-content" id="knowledgeEditor" contenteditable="true" data-placeholder="记录本时辰实际完成的事情..."></div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="actionText"><i class="fas fa-tasks"></i> 行难（下个时辰该做的事）</label>
                                            <div class="editor-container">
                                                <div class="editor-toolbar" id="actionToolbar">
                                                    <button class="editor-btn" data-command="insertOrderedList" title="有序列表"><i class="fas fa-list-ol"></i></button>
                                                    <button class="editor-btn" data-command="insertUnorderedList" title="无序列表"><i class="fas fa-list-ul"></i></button>
                                                    <button class="editor-btn" data-command="addCheckbox" title="添加任务复选框"><i class="far fa-check-square"></i></button>
                                                    <button class="editor-btn" data-command="highlight" title="高亮"><i class="fas fa-highlighter"></i></button>
                                                    <button class="editor-btn" data-command="clearFormat" title="清除格式"><i class="fas fa-eraser"></i></button>
                                                </div>
                                                <div class="editor-content" id="actionEditor" contenteditable="true" data-placeholder="写下个时辰计划要做的事情..."></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="moodSelect"><i class="fas fa-smile"></i> 心情</label>
                                            <select id="moodSelect">
                                                <option value="优">优</option>
                                                <option value="良" selected>良</option>
                                                <option value="中">中</option>
                                                <option value="差">差</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="energySelect"><i class="fas fa-battery-full"></i> 精神状态</label>
                                            <select id="energySelect">
                                                <option value="优">优</option>
                                                <option value="良" selected>良</option>
                                                <option value="中">中</option>
                                                <option value="差">差</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="action-buttons-small">
                                        <button class="action-btn-small save-period-btn" id="savePeriodBtn">
                                            <i class="fas fa-save"></i> 保存此时辰
                                        </button>
                                        <button class="action-btn-small clear-period-btn" id="clearPeriodBtn">
                                            <i class="fas fa-eraser"></i> 清空此时辰
                                        </button>
                                    </div>
                                </div>
                            </section>
                            
                            <section class="daily-summary">
                                <h2><i class="fas fa-edit"></i> 每日总结</h2>
                                <textarea id="summaryText" placeholder="写下今日的总结与反思..."></textarea>
                            </section>
                        </section>
                    </div>
                </div>
                
                <!-- 第二个面板：番茄钟 -->
                <div class="swipe-panel" id="panel2">
                    <section class="pomodoro-section">
                        <h2><i class="fas fa-clock"></i> 番茄钟专注</h2>
                        <div class="pomodoro-timer">
                            <div id="timerDisplay">25:00</div>
                            <div class="pomodoro-controls">
                                <button class="pomodoro-btn" id="startBtn"><i class="fas fa-play"></i> 开始</button>
                                <button class="pomodoro-btn" id="pauseBtn"><i class="fas fa-pause"></i> 暂停</button>
                                <button class="pomodoro-btn" id="resetBtn"><i class="fas fa-redo"></i> 重置</button>
                            </div>
                        </div>
                        <div class="pomodoro-stats">
                            <div class="tomato-count">
                                <span class="tomato-icon"><i class="fas fa-apple-alt"></i></span>
                                <span>今日番茄: <span id="tomatoCount">0</span> 个</span>
                            </div>
                            <div>累计专注: <span id="totalFocusTime">0</span> 分钟</div>
                        </div>
                        <div class="pomodoro-settings">
                            <div class="time-setting">
                                <label>专注时间 (分钟):</label>
                                <input type="number" id="focusTime" min="1" max="60" value="25">
                            </div>
                            <div class="time-setting">
                                <label>休息时间 (分钟):</label>
                                <input type="number" id="breakTime" min="1" max="30" value="5">
                            </div>
                        </div>
                    </section>
                </div>
                
                <!-- 第三个面板：数据分析 -->
                <div class="swipe-panel" id="panel3">
                    <section class="trends-section">
                        <h2><i class="fas fa-chart-line"></i> 数据分析</h2>
                        <div class="trends-tabs">
                            <button class="tab-btn active" data-tab="trend">趋势图</button>
                            <button class="tab-btn" data-tab="calendar">日历视图</button>
                            <button class="tab-btn" data-tab="stats">统计摘要</button>
                        </div>
                        
                        <div class="tab-content active" id="trendTab">
                            <div class="trends-controls">
                                <button class="trend-btn active" data-period="week">本周趋势</button>
                                <button class="trend-btn" data-period="month">本月趋势</button>
                                <button class="trend-btn" data-type="action">行为分析</button>
                                <button class="trend-btn" data-type="mood">心情趋势</button>
                                <button class="trend-btn" data-type="energy">精神状态</button>
                            </div>
                            <div class="chart-container">
                                <canvas id="trendChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="calendarTab">
                            <div class="calendar">
                                <div class="calendar-header">
                                    <div class="calendar-nav">
                                        <button class="calendar-nav-btn" id="prevMonthBtn">
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <div class="calendar-current" id="calendarMonth">2023年10月</div>
                                        <button class="calendar-nav-btn" id="nextMonthBtn">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </div>
                                    <button class="trend-btn" id="todayBtn">今天</button>
                                </div>
                                <div class="calendar-grid" id="calendarGrid">
                                    <!-- 日历将通过JavaScript动态生成 -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="statsTab">
                            <div class="stats-container">
                                <div class="form-row">
                                    <div class="form-group">
                                        <h3><i class="fas fa-chart-pie"></i> 行为分布</h3>
                                        <div class="chart-container">
                                            <canvas id="actionChart"></canvas>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <h3><i class="fas fa-chart-bar"></i> 本月统计</h3>
                                        <div id="monthStats">
                                            <!-- 统计信息将通过JavaScript动态生成 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="history-selector">
                            <label for="historyDate">查看历史记录：</label>
                            <input type="date" id="historyDate">
                            <button id="loadHistoryBtn">加载</button>
                        </div>
                    </section>
                </div>
                
                <!-- 第四个面板：云端设置 -->
                <div class="swipe-panel" id="panel4">
                    <section class="cloud-section">
                        <h2><i class="fas fa-cloud"></i> 云端同步</h2>
                        
                        <div class="cloud-settings">
                            <div class="cloud-status">
                                <div class="cloud-status-indicator">
                                    <div class="status-dot" id="cloudStatusDot"></div>
                                    <span id="cloudStatusText">未连接</span>
                                </div>
                                <button class="cloud-btn primary" id="autoSyncToggle">
                                    <i class="fas fa-sync-alt"></i> 自动同步: <span id="autoSyncStatus">关闭</span>
                                </button>
                            </div>
                            
                            <div class="cloud-controls">
                                <button class="cloud-btn primary" id="syncNowBtn">
                                    <i class="fas fa-cloud-upload-alt"></i> 立即同步
                                </button>
                                <button class="cloud-btn secondary" id="downloadFromCloudBtn">
                                    <i class="fas fa-cloud-download-alt"></i> 从云端下载
                                </button>
                                <button class="cloud-btn warning" id="testConnectionBtn">
                                    <i class="fas fa-wifi"></i> 测试连接
                                </button>
                            </div>
                        </div>
                        
                        <div class="cloud-form">
                            <h3><i class="fas fa-cog"></i> 坚果云WebDAV设置</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="webdavServer"><i class="fas fa-server"></i> 服务器地址</label>
                                    <input type="text" id="webdavServer" placeholder="https://dav.jianguoyun.com/dav/" value="https://dav.jianguoyun.com/dav/">
                                </div>
                                <div class="form-group">
                                    <label for="webdavUsername"><i class="fas fa-user"></i> 用户名/邮箱</label>
                                    <input type="text" id="webdavUsername" placeholder="您的坚果云用户名">
                                </div>
                                <div class="form-group">
                                    <label for="webdavPassword"><i class="fas fa-key"></i> 应用密码</label>
                                    <input type="password" id="webdavPassword" placeholder="坚果云的应用密码">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="webdavPath"><i class="fas fa-folder"></i> 保存路径</label>
                                    <input type="text" id="webdavPath" placeholder="/十二时辰日记/" value="/十二时辰日记/">
                                </div>
                                <div class="form-group">
                                    <label for="syncFrequency"><i class="fas fa-clock"></i> 同步频率（分钟）</label>
                                    <input type="number" id="syncFrequency" min="1" max="240" value="30">
                                </div>
                            </div>
                            <div class="action-buttons-small">
                                <button class="action-btn-small save-period-btn" id="saveCloudSettingsBtn">
                                    <i class="fas fa-save"></i> 保存设置
                                </button>
                                <button class="action-btn-small clear-period-btn" id="clearCloudSettingsBtn">
                                    <i class="fas fa-eraser"></i> 清除设置
                                </button>
                            </div>
                        </div>
                        
                        <div class="cloud-help">
                            <h4><i class="fas fa-question-circle"></i> 使用说明</h4>
                            <ul>
                                <li><strong>坚果云配置</strong>：需要在坚果云官网生成应用密码（不是登录密码）</li>
                                <li><strong>获取应用密码</strong>：登录坚果云 → 账户信息 → 安全选项 → 添加应用密码</li>
                                <li><strong>自动同步</strong>：开启后每隔指定时间自动同步数据到坚果云</li>
                                <li><strong>手动同步</strong>：点击"立即同步"手动上传数据到云端</li>
                                <li><strong>数据安全</strong>：所有数据使用Base64编码，避免明文存储敏感信息</li>
                                <li><strong>冲突处理</strong>：如果本地和云端都有修改，以时间戳较新的版本为准</li>
                            </ul>
                        </div>
                        
                        <div class="cloud-log">
                            <h3><i class="fas fa-clipboard-list"></i> 同步日志</h3>
                            <div id="cloudLog">
                                <!-- 同步日志将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
        
        <!-- 滑动导航 -->
        <div class="swipe-nav">
            <div class="swipe-dot active" data-panel="0"></div>
            <div class="swipe-dot" data-panel="1"></div>
            <div class="swipe-dot" data-panel="2"></div>
            <div class="swipe-dot" data-panel="3"></div>
        </div>
        
        <!-- 滑动导航按钮 -->
        <div class="swipe-nav-buttons">
            <button class="swipe-btn prev" id="prevPanelBtn">
                <i class="fas fa-chevron-left"></i> 上一界面
            </button>
            <button class="swipe-btn" id="nextPanelBtn">
                下一界面 <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        
        <!-- 数据导入导出区域 -->
        <section class="import-export-section">
            <h2><i class="fas fa-database"></i> 数据管理</h2>
            <div class="data-controls">
                <div class="import-export-buttons">
                    <button class="data-btn export-btn" id="exportDataBtn">
                        <i class="fas fa-download"></i> 导出数据
                    </button>
                    <button class="data-btn import-btn" id="importDataBtn">
                        <i class="fas fa-upload"></i> 导入数据
                    </button>
                    <button class="data-btn clear-all-btn" id="clearAllDataBtn">
                        <i class="fas fa-trash-alt"></i> 清空所有数据
                    </button>
                </div>
                <div class="import-instructions">
                    <h4>使用说明：</h4>
                    <ul>
                        <li><strong>导出数据</strong>：将您的所有日记数据导出为JSON文件</li>
                        <li><strong>导入数据</strong>：从JSON文件导入数据（会合并现有数据）</li>
                        <li><strong>清空所有数据</strong>：删除所有本地存储的日记数据</li>
                        <li>导入时遇到相同日期的数据会提示是否覆盖</li>
                        <li>建议定期导出备份数据以防丢失</li>
                    </ul>
                </div>
            </div>
        </section>
        
        <!-- 底部操作按钮 -->
        <div class="action-buttons">
            <button class="action-btn" id="saveBtn">
                <i class="fas fa-save"></i> 保存今日记录
            </button>
            <button class="action-btn" id="clearBtn">
                <i class="fas fa-eraser"></i> 清空今日记录
            </button>
            <button class="action-btn" id="cloudSyncBtn" style="background: #2196f3;">
                <i class="fas fa-cloud-upload-alt"></i> 云端同步
            </button>
        </div>
    </div>

    <!-- 隐藏的文件输入元素用于导入数据 -->
    <input type="file" id="importFileInput" accept=".json" style="display: none;">
    
    <!-- 云端同步确认模态框 -->
    <div class="modal" id="cloudSyncModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>云端同步</span>
                </div>
                <button class="modal-close" id="closeCloudSyncModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="cloudSyncProgress">
                    <p>正在同步数据到坚果云...</p>
                    <div style="width: 100%; height: 20px; background: #e8f5e9; border-radius: 10px; margin: 15px 0; overflow: hidden;">
                        <div id="cloudSyncProgressBar" style="width: 0%; height: 100%; background: #4caf50; transition: width 0.3s;"></div>
                    </div>
                    <p id="cloudSyncStatusText">准备中...</p>
                </div>
                <div id="cloudSyncResult" style="display: none;">
                    <h3 style="color: #4caf50; margin-bottom: 10px;">同步完成！</h3>
                    <p id="cloudSyncResultText"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="swipe-btn prev" id="cancelCloudSync" style="display: none;">取消</button>
                <button class="swipe-btn" id="closeCloudSync">确定</button>
            </div>
        </div>
    </div>
    
    <script>
        // 十二时辰数据
        const periods = [
            { name: "子时", time: "23:00-01:00", currentHour: [23, 0], order: 0 },
            { name: "丑时", time: "01:00-03:00", currentHour: [1, 2], order: 1 },
            { name: "寅时", time: "03:00-05:00", currentHour: [3, 4], order: 2 },
            { name: "卯时", time: "05:00-07:00", currentHour: [5, 6], order: 3 },
            { name: "辰时", time: "07:00-09:00", currentHour: [7, 8], order: 4 },
            { name: "巳时", time: "09:00-11:00", currentHour: [9, 10], order: 5 },
            { name: "午时", time: "11:00-13:00", currentHour: [11, 12], order: 6 },
            { name: "未时", time: "13:00-15:00", currentHour: [13, 14], order: 7 },
            { name: "申时", time: "15:00-17:00", currentHour: [15, 16], order: 8 },
            { name: "酉时", time: "17:00-19:00", currentHour: [17, 18], order: 9 },
            { name: "戌时", time: "19:00-21:00", currentHour: [19, 20], order: 10 },
            { name: "亥时", time: "21:00-23:00", currentHour: [21, 22], order: 11 }
        ];

        // 行为类型选项
        const actionOptions = [
            { value: "sleep", label: "睡觉", color: "#81c784", icon: "fas fa-bed" },
            { value: "growth", label: "成长", color: "#43a047", icon: "fas fa-seedling" },
            { value: "waste", label: "浪费", color: "#f39c12", icon: "fas fa-hourglass-half" },
            { value: "other", label: "其他", color: "#e74c3c", icon: "fas fa-ellipsis-h" }
        ];
        
        // 心情和精神状态选项
        const moodOptions = ["优", "良", "中", "差"];
        const energyOptions = ["优", "良", "中", "差"];
        
        // 当前日期
        let currentDate = new Date();
        let currentDateStr = currentDate.toISOString().split('T')[0];
        
        // 当前选中的时辰索引
        let currentPeriodIndex = 0;
        
        // 初始化数据存储
        let diaryData = {
            date: currentDateStr,
            periods: {},
            summary: "",
            pomodoroSessions: 0,
            totalFocusTime: 0
        };
        
        // 初始化图表
        let trendChart = null;
        let actionChart = null;
        
        // 番茄钟变量
        let timer = null;
        let isRunning = false;
        let isFocusTime = true;
        let timeLeft = 25 * 60; // 25分钟，以秒计
        let focusDuration = 25 * 60;
        let breakDuration = 5 * 60;
        let tomatoesToday = 0;
        
        // 日历变量
        let currentCalendarMonth = currentDate.getMonth();
        let currentCalendarYear = currentDate.getFullYear();
        
        // 滑动面板变量
        let currentPanelIndex = 0;
        const totalPanels = 4;
        
        // 云端同步变量
        let cloudSettings = {
            webdavServer: "https://dav.jianguoyun.com/dav/",
            webdavUsername: "",
            webdavPassword: "",
            webdavPath: "/十二时辰日记/",
            autoSync: false,
            syncFrequency: 30, // 分钟
            lastSync: null
        };
        
        let cloudSyncInterval = null;
        let isSyncing = false;
        
        // DOM 加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 显示当前日期
            updateCurrentDateDisplay();
            
            // 初始化紫微斗数十二宫格
            initPalaceGrid();
            
            // 设置历史日期选择器的默认值为今天
            document.getElementById('historyDate').value = currentDateStr;
            document.getElementById('historyDate').max = currentDateStr;
            
            // 加载今天的日记数据
            loadDiaryData(currentDateStr);
            
            // 初始化趋势图
            initTrendChart();
            
            // 初始化行为分布图
            initActionChart();
            
            // 初始化日历
            initCalendar();
            
            // 初始化编辑器
            initEditors();
            
            // 初始化云端设置
            initCloudSettings();
            
            // 设置事件监听器
            setupEventListeners();
            
            // 高亮当前时辰
            highlightCurrentPeriod();
            
            // 更新番茄钟显示
            updateTimerDisplay();
            
            // 更新番茄计数
            updateTomatoCount();
            
            // 移动端优化：调整滑动容器高度
            adjustSwipeContainerHeight();
            
            // 监听窗口大小变化
            window.addEventListener('resize', adjustSwipeContainerHeight);
        });
        
        // 更新当前日期显示
        function updateCurrentDateDisplay() {
            document.getElementById('currentDate').textContent = formatDate(currentDate);
        }
        
        // 调整滑动容器高度以适应移动端
        function adjustSwipeContainerHeight() {
            const swipeContainer = document.querySelector('.swipe-container');
            const windowHeight = window.innerHeight;
            const headerHeight = document.querySelector('header').offsetHeight;
            const navHeight = document.querySelector('.swipe-nav').offsetHeight;
            const buttonsHeight = document.querySelector('.swipe-nav-buttons').offsetHeight;
            const actionButtonsHeight = document.querySelector('.action-buttons').offsetHeight;
            const importExportHeight = document.querySelector('.import-export-section').offsetHeight;
            const margins = 100; // 上下边距
            
            if (window.innerWidth < 768) {
                // 移动端：计算可用高度
                const availableHeight = windowHeight - headerHeight - navHeight - buttonsHeight - actionButtonsHeight - importExportHeight - margins;
                swipeContainer.style.height = Math.max(400, availableHeight) + 'px';
            } else {
                // 桌面端：固定高度
                swipeContainer.style.height = '600px';
            }
        }
        
        // 初始化紫微斗数十二宫格
        function initPalaceGrid() {
            const grid = document.getElementById('palaceGrid');
            grid.innerHTML = '';
            
            periods.forEach((period, index) => {
                const cell = document.createElement('div');
                cell.className = `palace-cell palace-${index}`;
                cell.dataset.index = index;
                cell.dataset.period = period.name;
                
                cell.innerHTML = `
                    <div class="palace-name">${period.name}</div>
                    <div class="palace-time">${period.time}</div>
                    <div class="palace-status" id="status-${period.name}">
                        <!-- 状态图标将通过JavaScript动态更新 -->
                    </div>
                    <div class="action-icon" id="action-${period.name}">
                        <!-- 行为图标将通过JavaScript动态更新 -->
                    </div>
                `;
                
                grid.appendChild(cell);
                
                // 点击宫格选择时辰
                cell.addEventListener('click', () => {
                    selectPeriod(index);
                });
            });
            
            // 默认选中当前时辰或第一个时辰
            const currentHour = new Date().getHours();
            const currentPeriodIndex = periods.findIndex(p => p.currentHour.includes(currentHour));
            selectPeriod(currentPeriodIndex >= 0 ? currentPeriodIndex : 0);
        }
        
        // 初始化编辑器
        function initEditors() {
            // 为编辑器工具栏添加事件监听
            document.querySelectorAll('.editor-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const command = this.dataset.command;
                    const editorId = this.closest('.editor-container').querySelector('.editor-content').id;
                    const editor = document.getElementById(editorId);
                    
                    // 执行命令
                    executeEditorCommand(editor, command);
                    
                    // 更新按钮状态
                    updateEditorButtonState(this, command);
                });
            });
            
            // 为编辑器添加占位符处理
            const knowledgeEditor = document.getElementById('knowledgeEditor');
            const actionEditor = document.getElementById('actionEditor');
            
            // 设置data-placeholder属性
            knowledgeEditor.dataset.placeholder = '记录本时辰实际完成的事情...';
            actionEditor.dataset.placeholder = '写下个时辰计划要做的事情...';
            
            // 添加焦点事件
            [knowledgeEditor, actionEditor].forEach(editor => {
                // 焦点事件：如果内容是占位符，清空
                editor.addEventListener('focus', function() {
                    // 检查是否是空的或只有占位符
                    const isPlaceholder = this.textContent === this.dataset.placeholder || 
                                        (this.textContent.trim() === '' && !this.innerHTML.includes('<'));
                    
                    if (isPlaceholder) {
                        this.innerHTML = '';
                    }
                });
                
                // 输入事件：确保内容不是占位符
                editor.addEventListener('input', function() {
                    // 自动保存
                    clearTimeout(window.autoSaveTimeout);
                    window.autoSaveTimeout = setTimeout(() => {
                        saveEditorContent();
                    }, 2000);
                });
                
                // 失焦事件：如果内容为空，显示占位符
                editor.addEventListener('blur', function() {
                    if (this.textContent.trim() === '' || this.innerHTML === '<br>') {
                        this.innerHTML = '';
                        // 占位符通过CSS的::before显示
                    }
                });
                
                // 防止粘贴内容变成灰色
                editor.addEventListener('paste', function(e) {
                    e.preventDefault();
                    
                    // 获取粘贴的文本
                    const text = e.clipboardData.getData('text/plain');
                    
                    // 插入文本
                    document.execCommand('insertText', false, text);
                    
                    // 保存
                    saveEditorContent();
                });
            });
            
            // 添加点击事件处理复选框
            document.querySelectorAll('.editor-content').forEach(editor => {
                editor.addEventListener('click', function(e) {
                    if (e.target.type === 'checkbox') {
                        const checkbox = e.target;
                        const taskItem = checkbox.closest('.task-item');
                        if (taskItem) {
                            const taskContent = taskItem.querySelector('.task-content');
                            if (checkbox.checked) {
                                taskContent.classList.add('lined');
                            } else {
                                taskContent.classList.remove('lined');
                            }
                            saveEditorContent();
                        }
                    }
                });
            });
        }
        
        // 执行编辑器命令
        function executeEditorCommand(editor, command) {
            // 聚焦到编辑器
            editor.focus();
            
            switch(command) {
                case 'insertOrderedList':
                    document.execCommand('insertOrderedList', false, null);
                    break;
                    
                case 'insertUnorderedList':
                    document.execCommand('insertUnorderedList', false, null);
                    break;
                    
                case 'addCheckbox':
                    insertCheckbox(editor);
                    break;
                    
                case 'highlight':
                    document.execCommand('backColor', false, '#e8f5e9');
                    break;
                    
                case 'clearFormat':
                    document.execCommand('removeFormat', false, null);
                    document.execCommand('unlink', false, null);
                    break;
            }
            
            // 保存编辑器内容
            saveEditorContent();
        }
        
        // 插入复选框（优化版：复选框出现在选中的文字前面）
        function insertCheckbox(editor) {
            const selection = window.getSelection();
            const range = selection.getRangeAt(0);
            
            // 检查是否有选中的文本
            if (!range.collapsed) {
                // 有选中的文本，将选中文本转换为任务项
                const selectedContent = range.extractContents();
                
                // 创建任务项容器
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item';
                
                // 创建复选框
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'task-checkbox';
                
                // 创建任务内容容器
                const taskContent = document.createElement('div');
                taskContent.className = 'task-content';
                taskContent.contentEditable = 'true';
                
                // 将选中的内容放入任务内容中
                taskContent.appendChild(selectedContent);
                
                // 组装任务项
                taskItem.appendChild(checkbox);
                taskItem.appendChild(taskContent);
                
                // 插入到编辑器中
                range.insertNode(taskItem);
                
                // 添加换行
                const br = document.createElement('br');
                range.insertNode(br);
                
                // 移动光标到新行
                range.setStartAfter(br);
                range.setEndAfter(br);
                selection.removeAllRanges();
                selection.addRange(range);
            } else {
                // 没有选中文本，插入空任务项
                // 创建任务项容器
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item';
                
                // 创建复选框
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'task-checkbox';
                
                // 创建任务内容容器
                const taskContent = document.createElement('div');
                taskContent.className = 'task-content';
                taskContent.contentEditable = 'true';
                
                // 组装任务项
                taskItem.appendChild(checkbox);
                taskItem.appendChild(taskContent);
                
                // 插入到编辑器中
                range.insertNode(taskItem);
                
                // 添加换行
                const br = document.createElement('br');
                range.insertNode(br);
                
                // 移动光标到新行并聚焦到任务内容
                range.setStartAfter(br);
                range.setEndAfter(br);
                selection.removeAllRanges();
                selection.addRange(range);
                
                // 聚焦到任务内容
                taskContent.focus();
            }
            
            // 保存编辑器内容
            saveEditorContent();
        }
        
        // 更新编辑器按钮状态
        function updateEditorButtonState(button, command) {
            // 移除所有按钮的active类
            button.parentElement.querySelectorAll('.editor-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 为当前按钮添加active类（如果是切换类命令）
            if (['highlight'].includes(command)) {
                button.classList.toggle('active');
            }
        }
        
        // 保存编辑器内容
        function saveEditorContent() {
            const periodName = periods[currentPeriodIndex].name;
            
            if (!diaryData.periods[periodName]) {
                diaryData.periods[periodName] = {};
            }
            
            const knowledgeEditor = document.getElementById('knowledgeEditor');
            const actionEditor = document.getElementById('actionEditor');
            
            // 获取内容，如果内容是空的或者等于占位符，保存为空字符串
            let knowledgeContent = knowledgeEditor.innerHTML;
            let actionContent = actionEditor.innerHTML;
            
            // 检查是否是占位符状态（编辑器为空）
            if (knowledgeEditor.textContent.trim() === '' && !knowledgeEditor.innerHTML.includes('<')) {
                knowledgeContent = '';
            }
            
            if (actionEditor.textContent.trim() === '' && !actionEditor.innerHTML.includes('<')) {
                actionContent = '';
            }
            
            diaryData.periods[periodName].knowledge = knowledgeContent;
            diaryData.periods[periodName].actionPlan = actionContent;
        }
        
        // 加载编辑器内容
        function loadEditorContent(periodName) {
            const periodData = diaryData.periods[periodName] || {};
            
            const knowledgeEditor = document.getElementById('knowledgeEditor');
            const actionEditor = document.getElementById('actionEditor');
            
            // 加载知识编辑器内容
            if (periodData.knowledge && periodData.knowledge.trim() !== '') {
                knowledgeEditor.innerHTML = periodData.knowledge;
            } else {
                knowledgeEditor.innerHTML = '';
            }
            
            // 加载行动编辑器内容
            if (periodData.actionPlan && periodData.actionPlan.trim() !== '') {
                actionEditor.innerHTML = periodData.actionPlan;
            } else {
                actionEditor.innerHTML = '';
            }
            
            // 修复复选框的显示
            fixCheckboxesInEditor(knowledgeEditor);
            fixCheckboxesInEditor(actionEditor);
        }
        
        // 修复编辑器中的复选框显示
        function fixCheckboxesInEditor(editor) {
            // 查找所有复选框并修复它们的显示
            const checkboxes = editor.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                const taskItem = checkbox.closest('.task-item');
                if (taskItem) {
                    const taskContent = taskItem.querySelector('.task-content');
                    if (!taskContent) {
                        // 修复缺少task-content的情况
                        const contentDiv = document.createElement('div');
                        contentDiv.className = 'task-content';
                        contentDiv.contentEditable = 'true';
                        
                        // 移动兄弟节点到contentDiv
                        let nextSibling = checkbox.nextSibling;
                        while (nextSibling && nextSibling.nodeType === 1 && nextSibling.tagName !== 'DIV') {
                            contentDiv.appendChild(nextSibling);
                            nextSibling = checkbox.nextSibling;
                        }
                        
                        taskItem.appendChild(contentDiv);
                    }
                    
                    // 根据复选框状态设置样式
                    if (checkbox.checked) {
                        taskContent.classList.add('lined');
                    } else {
                        taskContent.classList.remove('lined');
                    }
                }
            });
        }
        
        // 更新宫格状态显示
        function updatePalaceStatus() {
            periods.forEach((period, index) => {
                const periodData = diaryData.periods[period.name] || {};
                const statusElement = document.getElementById(`status-${period.name}`);
                const actionElement = document.getElementById(`action-${period.name}`);
                
                // 清空状态显示
                statusElement.innerHTML = '';
                actionElement.innerHTML = '';
                
                // 如果有记录，显示心情和精神状态图标
                if (periodData.mood || periodData.energy) {
                    if (periodData.mood) {
                        const moodIcon = document.createElement('div');
                        moodIcon.className = `status-icon mood-${periodData.mood}`;
                        moodIcon.title = `心情: ${periodData.mood}`;
                        moodIcon.textContent = periodData.mood.charAt(0);
                        statusElement.appendChild(moodIcon);
                    }
                    
                    if (periodData.energy) {
                        const energyIcon = document.createElement('div');
                        energyIcon.className = `status-icon energy-${periodData.energy}`;
                        energyIcon.title = `精神: ${periodData.energy}`;
                        energyIcon.textContent = periodData.energy.charAt(0);
                        statusElement.appendChild(energyIcon);
                    }
                }
                
                // 显示行为图标
                if (periodData.action) {
                    const actionOption = actionOptions.find(opt => opt.value === periodData.action);
                    if (actionOption) {
                        actionElement.innerHTML = `<i class="${actionOption.icon} action-${periodData.action}"></i>`;
                        actionElement.title = actionOption.label;
                    }
                }
                
                // 更新宫格视觉状态
                const cell = document.querySelector(`.palace-cell[data-index="${index}"]`);
                if (periodData.knowledge || periodData.action) {
                    cell.style.opacity = "1";
                    cell.style.boxShadow = "0 3px 6px rgba(0, 0, 0, 0.08)";
                } else {
                    cell.style.opacity = "0.9";
                    cell.style.boxShadow = "none";
                }
            });
        }
        
        // 选择时辰
        function selectPeriod(index) {
            // 移除所有宫格的active类
            document.querySelectorAll('.palace-cell').forEach(cell => {
                cell.classList.remove('active');
            });
            
            // 添加当前宫格的active类
            document.querySelector(`.palace-cell[data-index="${index}"]`).classList.add('active');
            
            // 更新当前选中的时辰索引
            currentPeriodIndex = index;
            
            // 更新右侧表单
            updateRecordForm(index);
            
            // 更新选中时辰的状态指示器
            updatePeriodStatus();
        }
        
        // 更新记录表单
        function updateRecordForm(periodIndex) {
            const period = periods[periodIndex];
            
            // 更新标题
            document.getElementById('selectedPeriodName').textContent = period.name;
            document.getElementById('selectedPeriodTime').textContent = period.time;
            
            // 获取该时辰的数据
            const periodData = diaryData.periods[period.name] || {};
            
            // 更新表单字段
            document.getElementById('actionType').value = periodData.action || '';
            document.getElementById('moodSelect').value = periodData.mood || '良';
            document.getElementById('energySelect').value = periodData.energy || '良';
            
            // 更新编辑器内容
            loadEditorContent(period.name);
        }
        
        // 更新时辰状态指示器
        function updatePeriodStatus() {
            const periodName = periods[currentPeriodIndex].name;
            const periodData = diaryData.periods[periodName] || {};
            const statusIndicator = document.getElementById('periodStatus');
            
            if (periodData.knowledge || periodData.action) {
                statusIndicator.innerHTML = '<span class="status-indicator" style="background:#4caf50;"></span> 已记录';
            } else {
                statusIndicator.innerHTML = '<span class="status-indicator" style="background:#e74c3c;"></span> 未记录';
            }
        }
        
        // 高亮当前时辰
        function highlightCurrentPeriod() {
            const currentHour = new Date().getHours();
            const currentPeriodIndex = periods.findIndex(p => p.currentHour.includes(currentHour));
            
            if (currentPeriodIndex >= 0) {
                // 延迟一秒后高亮当前时辰，给用户一个视觉提示
                setTimeout(() => {
                    selectPeriod(currentPeriodIndex);
                    
                    // 短暂闪烁效果
                    const cell = document.querySelector(`.palace-cell[data-index="${currentPeriodIndex}"]`);
                    cell.classList.add('highlight');
                    setTimeout(() => {
                        cell.classList.remove('highlight');
                    }, 2000);
                }, 1000);
            }
        }
        
        // 加载日记数据
        function loadDiaryData(dateStr) {
            // 更新当前日期
            currentDate = new Date(dateStr);
            currentDateStr = dateStr;
            
            // 更新日期显示
            updateCurrentDateDisplay();
            
            // 更新历史日期选择器
            document.getElementById('historyDate').value = dateStr;
            
            const savedData = localStorage.getItem(`diary_${dateStr}`);
            if (savedData) {
                diaryData = JSON.parse(savedData);
                
                // 更新当前选中的时辰表单
                updateRecordForm(currentPeriodIndex);
                
                // 恢复每日总结
                document.getElementById('summaryText').value = diaryData.summary || '';
                
                // 更新番茄计数
                tomatoesToday = diaryData.pomodoroSessions || 0;
                updateTomatoCount();
                
                // 更新所有时辰的状态
                updatePalaceStatus();
                
                // 更新日历显示，高亮当前日期
                updateCalendar();
                
                console.log(`已加载 ${dateStr} 的日记数据`);
            } else {
                // 如果是新日期，重置数据
                if (dateStr !== diaryData.date) {
                    diaryData = {
                        date: dateStr,
                        periods: {},
                        summary: "",
                        pomodoroSessions: 0,
                        totalFocusTime: diaryData.totalFocusTime || 0
                    };
                    
                    // 重置表单
                    updateRecordForm(currentPeriodIndex);
                    document.getElementById('summaryText').value = '';
                    
                    // 重置番茄计数
                    tomatoesToday = 0;
                    updateTomatoCount();
                    
                    // 更新所有时辰的状态
                    updatePalaceStatus();
                }
            }
        }
        
        // 更新番茄计数显示
        function updateTomatoCount() {
            document.getElementById('tomatoCount').textContent = tomatoesToday;
            const focusMinutes = Math.floor((diaryData.totalFocusTime || 0) / 60);
            document.getElementById('totalFocusTime').textContent = focusMinutes;
        }
        
        // 保存当前时辰数据
        function saveCurrentPeriod() {
            const periodName = periods[currentPeriodIndex].name;
            
            // 保存编辑器内容
            saveEditorContent();
            
            diaryData.periods[periodName] = {
                action: document.getElementById('actionType').value,
                knowledge: document.getElementById('knowledgeEditor').innerHTML,
                actionPlan: document.getElementById('actionEditor').innerHTML,
                mood: document.getElementById('moodSelect').value,
                energy: document.getElementById('energySelect').value,
                timestamp: new Date().toISOString()
            };
            
            // 更新状态指示器
            updatePeriodStatus();
            updatePalaceStatus();
            
            // 保存到本地存储
            localStorage.setItem(`diary_${currentDateStr}`, JSON.stringify(diaryData));
            
            // 显示保存成功提示
            showNotification(`${periodName} 记录已保存！`, 'success');
            
            // 更新图表
            updateTrendChart();
            updateActionChart();
            
            // 更新日历显示
            updateCalendar();
            
            // 如果自动同步开启，触发自动同步
            if (cloudSettings.autoSync) {
                setTimeout(() => {
                    syncToCloud();
                }, 1000);
            }
        }
        
        // 清空当前时辰数据
        function clearCurrentPeriod() {
            if (confirm(`确定要清空 ${periods[currentPeriodIndex].name} 的记录吗？`)) {
                const periodName = periods[currentPeriodIndex].name;
                
                // 删除该时辰的数据
                delete diaryData.periods[periodName];
                
                // 重置表单
                document.getElementById('actionType').value = '';
                document.getElementById('moodSelect').value = '良';
                document.getElementById('energySelect').value = '良';
                
                // 重置编辑器
                const knowledgeEditor = document.getElementById('knowledgeEditor');
                const actionEditor = document.getElementById('actionEditor');
                
                knowledgeEditor.innerHTML = '';
                actionEditor.innerHTML = '';
                
                // 更新状态指示器
                updatePeriodStatus();
                updatePalaceStatus();
                
                // 保存到本地存储
                localStorage.setItem(`diary_${currentDateStr}`, JSON.stringify(diaryData));
                
                // 显示提示
                showNotification(`${periodName} 记录已清空`, 'info');
                
                // 更新图表
                updateTrendChart();
                updateActionChart();
                
                // 更新日历显示
                updateCalendar();
                
                // 如果自动同步开启，触发自动同步
                if (cloudSettings.autoSync) {
                    setTimeout(() => {
                        syncToCloud();
                    }, 1000);
                }
            }
        }
        
        // 保存所有日记数据
        function saveDiaryData() {
            // 先保存当前时辰数据
            saveCurrentPeriod();
            
            // 保存每日总结
            diaryData.summary = document.getElementById('summaryText').value;
            
            // 保存番茄钟数据
            diaryData.pomodoroSessions = tomatoesToday;
            
            // 保存到本地存储
            localStorage.setItem(`diary_${currentDateStr}`, JSON.stringify(diaryData));
            
            // 显示保存成功提示
            showNotification('今日日记已保存！', 'success');
            
            // 更新图表
            updateTrendChart();
            updateActionChart();
            
            // 更新日历显示
            updateCalendar();
            
            // 如果自动同步开启，触发自动同步
            if (cloudSettings.autoSync) {
                setTimeout(() => {
                    syncToCloud();
                }, 1000);
            }
        }
        
        // 清空所有日记数据
        function clearAllDiaryData() {
            if (confirm('确定要清空今日的所有记录吗？此操作不可撤销。')) {
                // 重置数据
                diaryData = {
                    date: currentDateStr,
                    periods: {},
                    summary: "",
                    pomodoroSessions: 0,
                    totalFocusTime: diaryData.totalFocusTime || 0
                };
                
                // 重置表单
                updateRecordForm(currentPeriodIndex);
                document.getElementById('summaryText').value = '';
                
                // 重置编辑器
                const knowledgeEditor = document.getElementById('knowledgeEditor');
                const actionEditor = document.getElementById('actionEditor');
                
                knowledgeEditor.innerHTML = '';
                actionEditor.innerHTML = '';
                
                // 重置番茄计数
                tomatoesToday = 0;
                updateTomatoCount();
                
                // 更新状态指示器
                updatePalaceStatus();
                
                // 保存到本地存储
                localStorage.setItem(`diary_${currentDateStr}`, JSON.stringify(diaryData));
                
                showNotification('今日记录已清空', 'info');
                
                // 更新图表
                updateTrendChart();
                updateActionChart();
                
                // 更新日历显示
                updateCalendar();
                
                // 如果自动同步开启，触发自动同步
                if (cloudSettings.autoSync) {
                    setTimeout(() => {
                        syncToCloud();
                    }, 1000);
                }
            }
        }
        
        // 导出所有数据
        function exportAllData() {
            // 收集所有日记数据
            const allData = {};
            const today = new Date();
            
            // 遍历最近一年的数据
            for (let i = 0; i < 365; i++) {
                const date = new Date();
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const savedData = localStorage.getItem(`diary_${dateStr}`);
                
                if (savedData) {
                    allData[dateStr] = JSON.parse(savedData);
                }
            }
            
            // 创建导出数据对象
            const exportData = {
                appName: "十二时辰日记",
                exportDate: new Date().toISOString(),
                data: allData
            };
            
            // 转换为JSON字符串
            const dataStr = JSON.stringify(exportData, null, 2);
            
            // 创建下载链接
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = `十二时辰日记_导出_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('数据导出成功！', 'success');
        }
        
        // 导入数据
        function importData() {
            document.getElementById('importFileInput').click();
        }
        
        // 处理文件导入
        function handleFileImport(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const importData = JSON.parse(event.target.result);
                    
                    // 验证导入数据格式
                    if (!importData.data || typeof importData.data !== 'object') {
                        showNotification('导入文件格式不正确', 'error');
                        return;
                    }
                    
                    // 统计导入的数据
                    let importedCount = 0;
                    let skippedCount = 0;
                    
                    // 遍历导入的数据
                    for (const dateStr in importData.data) {
                        const dateData = importData.data[dateStr];
                        
                        // 检查是否已有该日期的数据
                        const existingData = localStorage.getItem(`diary_${dateStr}`);
                        
                        if (existingData) {
                            // 询问是否覆盖
                            if (confirm(`发现已有 ${dateStr} 的数据，是否覆盖？`)) {
                                localStorage.setItem(`diary_${dateStr}`, JSON.stringify(dateData));
                                importedCount++;
                            } else {
                                skippedCount++;
                            }
                        } else {
                            // 直接导入
                            localStorage.setItem(`diary_${dateStr}`, JSON.stringify(dateData));
                            importedCount++;
                        }
                    }
                    
                    // 重新加载当前数据
                    loadDiaryData(currentDateStr);
                    
                    // 更新图表和日历
                    updateTrendChart();
                    updateActionChart();
                    updateCalendar();
                    
                    showNotification(`数据导入完成！成功导入 ${importedCount} 条记录，跳过 ${skippedCount} 条记录。`, 'success');
                    
                } catch (error) {
                    console.error('导入数据时出错:', error);
                    showNotification('导入文件格式不正确或已损坏', 'error');
                }
                
                // 清除文件输入的值，以便可以再次选择同一文件
                e.target.value = '';
            };
            
            reader.readAsText(file);
        }
        
        // 清空所有数据（所有日记记录）
        function clearAllStoredData() {
            if (confirm('确定要清空所有日记数据吗？此操作将删除所有已保存的记录，且不可撤销！')) {
                // 获取所有日记数据的键
                const keysToRemove = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('diary_')) {
                        keysToRemove.push(key);
                    }
                }
                
                // 删除所有日记数据
                keysToRemove.forEach(key => {
                    localStorage.removeItem(key);
                });
                
                // 重置当前数据
                diaryData = {
                    date: currentDateStr,
                    periods: {},
                    summary: "",
                    pomodoroSessions: 0,
                    totalFocusTime: 0
                };
                
                // 重置表单
                updateRecordForm(currentPeriodIndex);
                document.getElementById('summaryText').value = '';
                
                // 重置番茄计数
                tomatoesToday = 0;
                updateTomatoCount();
                
                // 更新状态指示器
                updatePalaceStatus();
                
                // 更新图表和日历
                updateTrendChart();
                updateActionChart();
                updateCalendar();
                
                showNotification('所有数据已清空', 'info');
            }
        }
        
        // 滑动到指定面板
        function goToPanel(panelIndex) {
            if (panelIndex < 0 || panelIndex >= totalPanels) return;
            
            currentPanelIndex = panelIndex;
            const swipeWrapper = document.getElementById('swipeWrapper');
            swipeWrapper.style.transform = `translateX(-${panelIndex * 25}%)`;
            
            // 更新导航点
            document.querySelectorAll('.swipe-dot').forEach((dot, index) => {
                if (index === panelIndex) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }
        
        // 初始化趋势图
        function initTrendChart() {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            // 获取最近7天的数据
            const weeklyData = getWeeklyData();
            
            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weeklyData.labels,
                    datasets: [
                        {
                            label: '行为指数',
                            data: weeklyData.actionScores,
                            borderColor: '#4caf50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: '心情指数',
                            data: weeklyData.moodScores,
                            borderColor: '#f39c12',
                            backgroundColor: 'rgba(243, 156, 18, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: '精神状态',
                            data: weeklyData.energyScores,
                            borderColor: '#43a047',
                            backgroundColor: 'rgba(67, 160, 71, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 4,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    const labels = ['差', '中', '良', '优'];
                                    return labels[value] || '';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const labels = ['差', '中', '良', '优'];
                                    const datasetLabel = context.dataset.label;
                                    const value = labels[context.raw] || context.raw;
                                    return `${datasetLabel}: ${value}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 更新趋势图
        function updateTrendChart(period = 'week', type = 'all') {
            let data;
            
            if (period === 'week') {
                data = getWeeklyData();
            } else {
                data = getMonthlyData();
            }
            
            // 更新图表数据
            trendChart.data.labels = data.labels;
            trendChart.data.datasets[0].data = data.actionScores;
            trendChart.data.datasets[1].data = data.moodScores;
            trendChart.data.datasets[2].data = data.energyScores;
            
            // 根据类型显示/隐藏数据集
            if (type === 'action') {
                trendChart.data.datasets[0].hidden = false;
                trendChart.data.datasets[1].hidden = true;
                trendChart.data.datasets[2].hidden = true;
            } else if (type === 'mood') {
                trendChart.data.datasets[0].hidden = true;
                trendChart.data.datasets[1].hidden = false;
                trendChart.data.datasets[2].hidden = true;
            } else if (type === 'energy') {
                trendChart.data.datasets[0].hidden = true;
                trendChart.data.datasets[1].hidden = true;
                trendChart.data.datasets[2].hidden = false;
            } else {
                trendChart.data.datasets[0].hidden = false;
                trendChart.data.datasets[1].hidden = false;
                trendChart.data.datasets[2].hidden = false;
            }
            
            trendChart.update();
        }
        
        // 获取最近7天数据
        function getWeeklyData() {
            const labels = [];
            const actionScores = [];
            const moodScores = [];
            const energyScores = [];
            
            // 获取最近7天的日期
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                labels.push(dateStr.substring(5)); // 只显示月-日
                
                // 获取当天的数据
                const savedData = localStorage.getItem(`diary_${dateStr}`);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    // 计算平均行为、心情和精神状态
                    let actionSum = 0, moodSum = 0, energySum = 0, count = 0;
                    
                    Object.values(data.periods).forEach(period => {
                        // 行为评分：睡觉=1, 浪费=1, 其他=2, 成长=3
                        if (period.action) {
                            let actionScore = 0;
                            switch(period.action) {
                                case 'sleep': actionScore = 1; break;
                                case 'waste': actionScore = 1; break;
                                case 'other': actionScore = 2; break;
                                case 'growth': actionScore = 3; break;
                                default: actionScore = 1;
                            }
                            actionSum += actionScore;
                        }
                        
                        if (period.mood) {
                            moodSum += moodOptions.indexOf(period.mood);
                        }
                        
                        if (period.energy) {
                            energySum += energyOptions.indexOf(period.energy);
                        }
                        
                        count++;
                    });
                    
                    actionScores.push(count > 0 ? actionSum / count : null);
                    moodScores.push(count > 0 ? moodSum / count : null);
                    energyScores.push(count > 0 ? energySum / count : null);
                } else {
                    actionScores.push(null);
                    moodScores.push(null);
                    energyScores.push(null);
                }
            }
            
            return { labels, actionScores, moodScores, energyScores };
        }
        
        // 获取最近30天数据
        function getMonthlyData() {
            const labels = [];
            const actionScores = [];
            const moodScores = [];
            const energyScores = [];
            
            // 获取最近30天的日期
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                labels.push(dateStr.substring(5)); // 只显示月-日
                
                // 获取当天的数据
                const savedData = localStorage.getItem(`diary_${dateStr}`);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    // 计算平均行为、心情和精神状态
                    let actionSum = 0, moodSum = 0, energySum = 0, count = 0;
                    
                    Object.values(data.periods).forEach(period => {
                        // 行为评分
                        if (period.action) {
                            let actionScore = 0;
                            switch(period.action) {
                                case 'sleep': actionScore = 1; break;
                                case 'waste': actionScore = 1; break;
                                case 'other': actionScore = 2; break;
                                case 'growth': actionScore = 3; break;
                                default: actionScore = 1;
                            }
                            actionSum += actionScore;
                        }
                        
                        if (period.mood) {
                            moodSum += moodOptions.indexOf(period.mood);
                        }
                        
                        if (period.energy) {
                            energySum += energyOptions.indexOf(period.energy);
                        }
                        
                        count++;
                    });
                    
                    actionScores.push(count > 0 ? actionSum / count : null);
                    moodScores.push(count > 0 ? moodSum / count : null);
                    energyScores.push(count > 0 ? energySum / count : null);
                } else {
                    actionScores.push(null);
                    moodScores.push(null);
                    energyScores.push(null);
                }
            }
            
            return { labels, actionScores, moodScores, energyScores };
        }
        
        // 初始化行为分布图
        function initActionChart() {
            const ctx = document.getElementById('actionChart').getContext('2d');
            
            // 获取当前月份的行为分布数据
            const actionData = getActionDistribution();
            
            actionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: actionData.labels,
                    datasets: [{
                        data: actionData.values,
                        backgroundColor: actionData.colors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} 次 (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 更新行为分布图
        function updateActionChart() {
            const actionData = getActionDistribution();
            
            actionChart.data.labels = actionData.labels;
            actionChart.data.datasets[0].data = actionData.values;
            actionChart.data.datasets[0].backgroundColor = actionData.colors;
            
            actionChart.update();
        }
        
        // 获取行为分布数据
        function getActionDistribution() {
            const currentMonth = currentDate.getMonth();
            const currentYear = currentDate.getFullYear();
            
            // 初始化行为计数器
            const actionCounts = {
                sleep: 0,
                growth: 0,
                waste: 0,
                other: 0
            };
            
            // 遍历本月的每一天
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const savedData = localStorage.getItem(`diary_${dateStr}`);
                
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    // 统计每个时辰的行为
                    Object.values(data.periods).forEach(period => {
                        if (period.action && actionCounts.hasOwnProperty(period.action)) {
                            actionCounts[period.action]++;
                        }
                    });
                }
            }
            
            // 准备图表数据
            const labels = [];
            const values = [];
            const colors = [];
            
            actionOptions.forEach(option => {
                labels.push(option.label);
                values.push(actionCounts[option.value]);
                colors.push(option.color);
            });
            
            return { labels, values, colors };
        }
        
        // 初始化日历
        function initCalendar() {
            updateCalendar();
        }
        
        // 更新日历显示
        function updateCalendar() {
            const monthNames = ["一月", "二月", "三月", "四月", "五月", "六月", 
                               "七月", "八月", "九月", "十月", "十一月", "十二月"];
            
            // 更新日历标题
            document.getElementById('calendarMonth').textContent = 
                `${currentCalendarYear}年${monthNames[currentCalendarMonth]}`;
            
            // 获取该月的第一天是星期几
            const firstDay = new Date(currentCalendarYear, currentCalendarMonth, 1);
            const firstDayWeekday = firstDay.getDay(); // 0 = 星期日, 1 = 星期一, ...
            
            // 获取该月的天数
            const daysInMonth = new Date(currentCalendarYear, currentCalendarMonth + 1, 0).getDate();
            
            // 获取上个月的天数
            const prevMonthDays = new Date(currentCalendarYear, currentCalendarMonth, 0).getDate();
            
            // 清空日历网格
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';
            
            // 添加星期标题
            const weekdays = ["日", "一", "二", "三", "四", "五", "六"];
            weekdays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            // 添加上个月的日期
            for (let i = firstDayWeekday - 1; i >= 0; i--) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.innerHTML = `<div class="day-number">${prevMonthDays - i}</div>`;
                day.style.opacity = "0.4";
                calendarGrid.appendChild(day);
            }
            
            // 添加本月的日期
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                const dateStr = `${currentCalendarYear}-${String(currentCalendarMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const isToday = dateStr === new Date().toISOString().split('T')[0];
                const isCurrentDate = dateStr === currentDateStr;
                
                if (isToday) {
                    dayElement.classList.add('current');
                }
                
                if (isCurrentDate) {
                    dayElement.classList.add('active-date');
                }
                
                dayElement.innerHTML = `<div class="day-number">${day}</div>`;
                
                // 检查该日期是否有数据
                const savedData = localStorage.getItem(`diary_${dateStr}`);
                if (savedData) {
                    dayElement.classList.add('has-data');
                    const data = JSON.parse(savedData);
                    
                    // 添加番茄计数
                    if (data.pomodoroSessions > 0) {
                        const tomatoElement = document.createElement('div');
                        tomatoElement.className = 'day-tomato';
                        tomatoElement.innerHTML = `<i class="fas fa-apple-alt"></i> ${data.pomodoroSessions}`;
                        dayElement.appendChild(tomatoElement);
                    }
                    
                    // 计算平均心情
                    let moodSum = 0, moodCount = 0;
                    Object.values(data.periods).forEach(period => {
                        if (period.mood) {
                            moodSum += moodOptions.indexOf(period.mood);
                            moodCount++;
                        }
                    });
                    
                    // 添加心情指示器
                    if (moodCount > 0) {
                        const avgMood = moodSum / moodCount;
                        const moodColor = avgMood >= 3 ? '#43a047' : avgMood >= 2 ? '#66bb6a' : avgMood >= 1 ? '#f1c40f' : '#e74c3c';
                        
                        const indicatorsElement = document.createElement('div');
                        indicatorsElement.className = 'day-indicators';
                        
                        const moodIndicator = document.createElement('div');
                        moodIndicator.className = 'day-indicator';
                        moodIndicator.style.backgroundColor = moodColor;
                        moodIndicator.title = `平均心情: ${moodOptions[Math.round(avgMood)] || '中'}`;
                        
                        indicatorsElement.appendChild(moodIndicator);
                        dayElement.appendChild(indicatorsElement);
                    }
                }
                
                // 点击日期加载该日记录
                dayElement.addEventListener('click', () => {
                    loadDiaryData(dateStr);
                    showNotification(`已加载 ${dateStr} 的记录`, 'success');
                    
                    // 回到第一个面板
                    goToPanel(0);
                    
                    // 更新日历显示
                    updateCalendar();
                });
                
                calendarGrid.appendChild(dayElement);
            }
            
            // 添加下个月的日期
            const totalCells = 42; // 6行 * 7列
            const cellsUsed = firstDayWeekday + daysInMonth;
            const nextMonthDays = totalCells - cellsUsed;
            
            for (let day = 1; day <= nextMonthDays; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.innerHTML = `<div class="day-number">${day}</div>`;
                dayElement.style.opacity = "0.4";
                calendarGrid.appendChild(dayElement);
            }
        }
        
        // 番茄钟功能
        function startTimer() {
            if (isRunning) return;
            
            isRunning = true;
            timer = setInterval(() => {
                timeLeft--;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    isRunning = false;
                    
                    // 播放提示音
                    playNotificationSound();
                    
                    // 切换专注/休息时间
                    if (isFocusTime) {
                        // 专注时间结束，切换到休息时间
                        isFocusTime = false;
                        timeLeft = breakDuration;
                        showNotification('专注时间结束，开始休息！', 'success');
                        
                        // 记录番茄钟
                        tomatoesToday++;
                        diaryData.pomodoroSessions = tomatoesToday;
                        diaryData.totalFocusTime = (diaryData.totalFocusTime || 0) + focusDuration;
                        
                        // 更新显示
                        updateTomatoCount();
                        
                        // 保存数据
                        localStorage.setItem(`diary_${currentDateStr}`, JSON.stringify(diaryData));
                        
                        // 更新日历显示
                        updateCalendar();
                        
                        // 如果自动同步开启，触发自动同步
                        if (cloudSettings.autoSync) {
                            setTimeout(() => {
                                syncToCloud();
                            }, 1000);
                        }
                    } else {
                        // 休息时间结束，切换回专注时间
                        isFocusTime = true;
                        timeLeft = focusDuration;
                        showNotification('休息时间结束，开始专注！', 'info');
                    }
                    
                    // 更新显示并重新开始计时器
                    updateTimerDisplay();
                    startTimer();
                } else {
                    updateTimerDisplay();
                }
            }, 1000);
        }
        
        function pauseTimer() {
            if (!isRunning) return;
            
            clearInterval(timer);
            isRunning = false;
            showNotification('番茄钟已暂停', 'info');
        }
        
        function resetTimer() {
            clearInterval(timer);
            isRunning = false;
            isFocusTime = true;
            timeLeft = focusDuration;
            updateTimerDisplay();
            showNotification('番茄钟已重置', 'info');
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timerDisplay = document.getElementById('timerDisplay');
            
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // 根据状态改变颜色
            if (isFocusTime) {
                timerDisplay.style.color = '#4caf50';
            } else {
                timerDisplay.style.color = '#f39c12';
            }
        }
        
        function updateTimerSettings() {
            focusDuration = parseInt(document.getElementById('focusTime').value) * 60;
            breakDuration = parseInt(document.getElementById('breakTime').value) * 60;
            
            if (!isRunning) {
                timeLeft = isFocusTime ? focusDuration : breakDuration;
                updateTimerDisplay();
            }
        }
        
        // 播放提示音
        function playNotificationSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log('音频播放失败:', e);
            }
        }
        
        // 显示通知
        function showNotification(message, type) {
            // 移除现有的通知
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // 创建新通知
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // 3秒后自动移除
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.5s';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }
        
        // ==================== 云端同步功能 ====================
        
        // 初始化云端设置
        function initCloudSettings() {
            // 从本地存储加载云端设置
            const savedSettings = localStorage.getItem('diary_cloud_settings');
            if (savedSettings) {
                cloudSettings = JSON.parse(savedSettings);
                
                // 更新表单显示
                document.getElementById('webdavServer').value = cloudSettings.webdavServer;
                document.getElementById('webdavUsername').value = cloudSettings.webdavUsername;
                document.getElementById('webdavPassword').value = cloudSettings.webdavPassword;
                document.getElementById('webdavPath').value = cloudSettings.webdavPath;
                document.getElementById('syncFrequency').value = cloudSettings.syncFrequency;
                
                // 更新自动同步状态
                updateAutoSyncStatus();
                
                // 更新云端状态显示
                updateCloudStatus();
                
                // 如果自动同步开启，启动定时器
                if (cloudSettings.autoSync) {
                    startAutoSync();
                }
            }
        }
        
        // 保存云端设置
        function saveCloudSettings() {
            cloudSettings = {
                webdavServer: document.getElementById('webdavServer').value,
                webdavUsername: document.getElementById('webdavUsername').value,
                webdavPassword: document.getElementById('webdavPassword').value,
                webdavPath: document.getElementById('webdavPath').value,
                autoSync: cloudSettings.autoSync,
                syncFrequency: parseInt(document.getElementById('syncFrequency').value) || 30,
                lastSync: cloudSettings.lastSync
            };
            
            // 保存到本地存储
            localStorage.setItem('diary_cloud_settings', JSON.stringify(cloudSettings));
            
            // 更新自动同步状态
            updateAutoSyncStatus();
            
            // 如果自动同步开启，重启定时器
            if (cloudSettings.autoSync) {
                startAutoSync();
            }
            
            showNotification('云端设置已保存', 'success');
            addCloudLog('设置已保存', 'info');
        }
        
        // 清除云端设置
        function clearCloudSettings() {
            if (confirm('确定要清除云端设置吗？这将断开与坚果云的连接。')) {
                cloudSettings = {
                    webdavServer: "https://dav.jianguoyun.com/dav/",
                    webdavUsername: "",
                    webdavPassword: "",
                    webdavPath: "/十二时辰日记/",
                    autoSync: false,
                    syncFrequency: 30,
                    lastSync: null
                };
                
                // 清除本地存储
                localStorage.removeItem('diary_cloud_settings');
                
                // 更新表单显示
                document.getElementById('webdavServer').value = cloudSettings.webdavServer;
                document.getElementById('webdavUsername').value = cloudSettings.webdavUsername;
                document.getElementById('webdavPassword').value = cloudSettings.webdavPassword;
                document.getElementById('webdavPath').value = cloudSettings.webdavPath;
                document.getElementById('syncFrequency').value = cloudSettings.syncFrequency;
                
                // 停止自动同步
                stopAutoSync();
                
                // 更新状态显示
                updateAutoSyncStatus();
                updateCloudStatus();
                
                showNotification('云端设置已清除', 'info');
                addCloudLog('设置已清除', 'info');
            }
        }
        
        // 更新自动同步状态
        function updateAutoSyncStatus() {
            const autoSyncToggle = document.getElementById('autoSyncToggle');
            const autoSyncStatus = document.getElementById('autoSyncStatus');
            
            if (cloudSettings.autoSync) {
                autoSyncStatus.textContent = '开启';
                autoSyncToggle.style.background = '#4caf50';
            } else {
                autoSyncStatus.textContent = '关闭';
                autoSyncToggle.style.background = '#2196f3';
            }
        }
        
        // 切换自动同步
        function toggleAutoSync() {
            cloudSettings.autoSync = !cloudSettings.autoSync;
            
            if (cloudSettings.autoSync) {
                // 验证设置是否完整
                if (!cloudSettings.webdavUsername || !cloudSettings.webdavPassword) {
                    showNotification('请先配置坚果云用户名和密码', 'error');
                    cloudSettings.autoSync = false;
                    updateAutoSyncStatus();
                    return;
                }
                
                startAutoSync();
                showNotification('自动同步已开启', 'success');
                addCloudLog('自动同步已开启', 'success');
            } else {
                stopAutoSync();
                showNotification('自动同步已关闭', 'info');
                addCloudLog('自动同步已关闭', 'info');
            }
            
            // 保存设置
            localStorage.setItem('diary_cloud_settings', JSON.stringify(cloudSettings));
            updateAutoSyncStatus();
        }
        
        // 启动自动同步定时器
        function startAutoSync() {
            // 清除现有定时器
            stopAutoSync();
            
            // 设置新的定时器
            const frequency = cloudSettings.syncFrequency * 60 * 1000; // 转换为毫秒
            cloudSyncInterval = setInterval(() => {
                if (!isSyncing) {
                    syncToCloud();
                }
            }, frequency);
            
            // 立即执行一次同步
            setTimeout(() => {
                if (!isSyncing) {
                    syncToCloud();
                }
            }, 3000);
        }
        
        // 停止自动同步定时器
        function stopAutoSync() {
            if (cloudSyncInterval) {
                clearInterval(cloudSyncInterval);
                cloudSyncInterval = null;
            }
        }
        
        // 更新云端状态显示
        function updateCloudStatus() {
            const statusDot = document.getElementById('cloudStatusDot');
            const statusText = document.getElementById('cloudStatusText');
            
            if (isSyncing) {
                statusDot.className = 'status-dot syncing';
                statusText.textContent = '同步中...';
            } else if (cloudSettings.webdavUsername && cloudSettings.webdavPassword) {
                statusDot.className = 'status-dot connected';
                statusText.textContent = '已连接';
            } else {
                statusDot.className = 'status-dot';
                statusText.textContent = '未连接';
            }
        }
        
        // 添加云端同步日志
        function addCloudLog(message, type = 'info') {
            const logContainer = document.getElementById('cloudLog');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            
            const now = new Date();
            const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            
            logEntry.innerHTML = `<span class="log-time">${timeStr}</span> ${message}`;
            
            logContainer.appendChild(logEntry);
            
            // 限制日志数量，最多保留50条
            const logs = logContainer.querySelectorAll('.log-entry');
            if (logs.length > 50) {
                logs[0].remove();
            }
            
            // 自动滚动到底部
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // 测试坚果云连接
        async function testCloudConnection() {
            if (!cloudSettings.webdavUsername || !cloudSettings.webdavPassword) {
                showNotification('请先配置坚果云用户名和密码', 'error');
                return;
            }
            
            isSyncing = true;
            updateCloudStatus();
            addCloudLog('测试坚果云连接...', 'info');
            
            try {
                const testUrl = cloudSettings.webdavServer;
                const auth = btoa(`${cloudSettings.webdavUsername}:${cloudSettings.webdavPassword}`);
                
                const response = await fetch(testUrl, {
                    method: 'PROPFIND',
                    headers: {
                        'Authorization': `Basic ${auth}`,
                        'Depth': '0'
                    }
                });
                
                if (response.ok) {
                    showNotification('坚果云连接成功！', 'success');
                    addCloudLog('连接测试成功', 'success');
                } else {
                    throw new Error(`连接失败: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                console.error('连接测试失败:', error);
                showNotification(`连接失败: ${error.message}`, 'error');
                addCloudLog(`连接失败: ${error.message}`, 'error');
            } finally {
                isSyncing = false;
                updateCloudStatus();
            }
        }
        
        // 同步数据到坚果云
        async function syncToCloud() {
            if (!cloudSettings.webdavUsername || !cloudSettings.webdavPassword) {
                showNotification('请先配置坚果云用户名和密码', 'error');
                return;
            }
            
            if (isSyncing) {
                showNotification('已有同步任务在进行中', 'info');
                return;
            }
            
            isSyncing = true;
            updateCloudStatus();
            
            // 显示同步模态框
            showCloudSyncModal();
            
            try {
                addCloudLog('开始同步数据到坚果云...', 'info');
                updateSyncProgress(10, '准备数据...');
                
                // 1. 收集所有本地数据
                const allData = {};
                const today = new Date();
                
                // 遍历最近一年的数据
                for (let i = 0; i < 365; i++) {
                    const date = new Date();
                    date.setDate(today.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    const savedData = localStorage.getItem(`diary_${dateStr}`);
                    
                    if (savedData) {
                        allData[dateStr] = JSON.parse(savedData);
                    }
                }
                
                updateSyncProgress(30, '数据准备完成');
                
                // 2. 创建上传数据
                const uploadData = {
                    appName: "十二时辰日记",
                    syncDate: new Date().toISOString(),
                    data: allData
                };
                
                const dataStr = JSON.stringify(uploadData, null, 2);
                const encodedData = btoa(unescape(encodeURIComponent(dataStr))); // Base64编码
                
                updateSyncProgress(50, '数据编码完成');
                
                // 3. 准备坚果云路径
                const fileName = `diary_backup_${new Date().toISOString().split('T')[0]}.json`;
                const filePath = cloudSettings.webdavPath.replace(/\/$/, '') + '/' + fileName;
                const fullUrl = cloudSettings.webdavServer.replace(/\/$/, '') + filePath;
                
                const auth = btoa(`${cloudSettings.webdavUsername}:${cloudSettings.webdavPassword}`);
                
                updateSyncProgress(70, '上传数据到坚果云...');
                
                // 4. 上传数据
                const response = await fetch(fullUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Basic ${auth}`,
                        'Content-Type': 'application/json'
                    },
                    body: encodedData
                });
                
                if (response.ok) {
                    updateSyncProgress(90, '数据上传成功');
                    
                    // 5. 保存同步记录
                    cloudSettings.lastSync = new Date().toISOString();
                    localStorage.setItem('diary_cloud_settings', JSON.stringify(cloudSettings));
                    
                    updateSyncProgress(100, '同步完成！');
                    
                    // 显示成功结果
                    showSyncResult('数据同步到坚果云成功！');
                    addCloudLog('数据同步成功', 'success');
                    
                    showNotification('数据已同步到坚果云', 'success');
                } else {
                    throw new Error(`上传失败: ${response.status} ${response.statusText}`);
                }
                
            } catch (error) {
                console.error('同步失败:', error);
                updateSyncProgress(0, '同步失败');
                showSyncResult(`同步失败: ${error.message}`, true);
                addCloudLog(`同步失败: ${error.message}`, 'error');
                showNotification('同步失败', 'error');
            } finally {
                isSyncing = false;
                updateCloudStatus();
            }
        }
        
        // 从坚果云下载数据
        async function downloadFromCloud() {
            if (!cloudSettings.webdavUsername || !cloudSettings.webdavPassword) {
                showNotification('请先配置坚果云用户名和密码', 'error');
                return;
            }
            
            if (isSyncing) {
                showNotification('已有同步任务在进行中', 'info');
                return;
            }
            
            isSyncing = true;
            updateCloudStatus();
            
            // 显示同步模态框
            showCloudSyncModal();
            
            try {
                addCloudLog('从坚果云下载数据...', 'info');
                updateSyncProgress(10, '连接坚果云...');
                
                // 1. 获取坚果云目录列表
                const dirPath = cloudSettings.webdavPath.replace(/\/$/, '') + '/';
                const dirUrl = cloudSettings.webdavServer.replace(/\/$/, '') + dirPath;
                
                const auth = btoa(`${cloudSettings.webdavUsername}:${cloudSettings.webdavPassword}`);
                
                updateSyncProgress(30, '获取文件列表...');
                
                // 获取目录内容
                const listResponse = await fetch(dirUrl, {
                    method: 'PROPFIND',
                    headers: {
                        'Authorization': `Basic ${auth}`,
                        'Depth': '1'
                    }
                });
                
                if (!listResponse.ok) {
                    throw new Error(`无法访问目录: ${listResponse.status} ${listResponse.statusText}`);
                }
                
                const listText = await listResponse.text();
                
                // 解析XML响应，找到最新的备份文件
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(listText, 'text/xml');
                const responses = xmlDoc.getElementsByTagName('D:response');
                
                let latestFile = null;
                let latestDate = null;
                
                for (let response of responses) {
                    const href = response.getElementsByTagName('D:href')[0]?.textContent;
                    const displayName = response.getElementsByTagName('D:displayname')[0]?.textContent;
                    
                    if (href && displayName && displayName.startsWith('diary_backup_') && displayName.endsWith('.json')) {
                        // 提取日期
                        const dateMatch = displayName.match(/diary_backup_(\d{4}-\d{2}-\d{2})\.json/);
                        if (dateMatch) {
                            const fileDate = dateMatch[1];
                            if (!latestDate || fileDate > latestDate) {
                                latestDate = fileDate;
                                latestFile = href;
                            }
                        }
                    }
                }
                
                if (!latestFile) {
                    throw new Error('未找到备份文件');
                }
                
                updateSyncProgress(50, '找到最新备份文件');
                
                // 2. 下载最新备份文件
                const fileUrl = cloudSettings.webdavServer.replace(/\/$/, '') + latestFile;
                
                updateSyncProgress(70, '下载文件...');
                
                const fileResponse = await fetch(fileUrl, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Basic ${auth}`
                    }
                });
                
                if (!fileResponse.ok) {
                    throw new Error(`下载失败: ${fileResponse.status} ${fileResponse.statusText}`);
                }
                
                const encodedData = await fileResponse.text();
                const dataStr = decodeURIComponent(escape(atob(encodedData))); // Base64解码
                const cloudData = JSON.parse(dataStr);
                
                updateSyncProgress(90, '解析数据...');
                
                // 3. 合并数据到本地
                let importedCount = 0;
                let skippedCount = 0;
                
                // 遍历云端数据
                for (const dateStr in cloudData.data) {
                    const dateData = cloudData.data[dateStr];
                    
                    // 检查是否已有该日期的数据
                    const existingData = localStorage.getItem(`diary_${dateStr}`);
                    
                    if (existingData) {
                        // 比较时间戳，保留最新的
                        const localData = JSON.parse(existingData);
                        const cloudTimestamp = dateData._syncTimestamp || '1970-01-01T00:00:00.000Z';
                        const localTimestamp = localData._syncTimestamp || '1970-01-01T00:00:00.000Z';
                        
                        if (new Date(cloudTimestamp) > new Date(localTimestamp)) {
                            // 云端数据更新，覆盖本地
                            localStorage.setItem(`diary_${dateStr}`, JSON.stringify(dateData));
                            importedCount++;
                        } else {
                            skippedCount++;
                        }
                    } else {
                        // 直接导入
                        localStorage.setItem(`diary_${dateStr}`, JSON.stringify(dateData));
                        importedCount++;
                    }
                }
                
                updateSyncProgress(100, '下载完成！');
                
                // 重新加载当前数据
                loadDiaryData(currentDateStr);
                
                // 显示结果
                showSyncResult(`从坚果云恢复数据成功！<br>导入 ${importedCount} 条记录，跳过 ${skippedCount} 条记录。`);
                addCloudLog(`数据恢复成功: 导入 ${importedCount} 条记录`, 'success');
                
                showNotification('数据已从坚果云恢复', 'success');
                
            } catch (error) {
                console.error('下载失败:', error);
                updateSyncProgress(0, '下载失败');
                showSyncResult(`下载失败: ${error.message}`, true);
                addCloudLog(`下载失败: ${error.message}`, 'error');
                showNotification('下载失败', 'error');
            } finally {
                isSyncing = false;
                updateCloudStatus();
            }
        }
        
        // 显示云端同步模态框
        function showCloudSyncModal() {
            const modal = document.getElementById('cloudSyncModal');
            modal.classList.add('active');
            
            // 重置进度
            updateSyncProgress(0, '准备中...');
            
            // 隐藏结果，显示进度
            document.getElementById('cloudSyncProgress').style.display = 'block';
            document.getElementById('cloudSyncResult').style.display = 'none';
            
            // 显示取消按钮
            document.getElementById('cancelCloudSync').style.display = 'inline-block';
        }
        
        // 隐藏云端同步模态框
        function hideCloudSyncModal() {
            const modal = document.getElementById('cloudSyncModal');
            modal.classList.remove('active');
        }
        
        // 更新同步进度
        function updateSyncProgress(percent, status) {
            const progressBar = document.getElementById('cloudSyncProgressBar');
            const statusText = document.getElementById('cloudSyncStatusText');
            
            progressBar.style.width = percent + '%';
            statusText.textContent = status;
        }
        
        // 显示同步结果
        function showSyncResult(message, isError = false) {
            const progress = document.getElementById('cloudSyncProgress');
            const result = document.getElementById('cloudSyncResult');
            const resultText = document.getElementById('cloudSyncResultText');
            const cancelBtn = document.getElementById('cancelCloudSync');
            
            progress.style.display = 'none';
            result.style.display = 'block';
            resultText.innerHTML = message;
            
            if (isError) {
                resultText.style.color = '#e74c3c';
            } else {
                resultText.style.color = '#4caf50';
            }
            
            // 隐藏取消按钮
            cancelBtn.style.display = 'none';
        }
        
        // ==================== 事件监听器设置 ====================
        
        // 设置事件监听器
        function setupEventListeners() {
            // 保存当前时辰按钮
            document.getElementById('savePeriodBtn').addEventListener('click', saveCurrentPeriod);
            
            // 清空当前时辰按钮
            document.getElementById('clearPeriodBtn').addEventListener('click', clearCurrentPeriod);
            
            // 保存所有按钮
            document.getElementById('saveBtn').addEventListener('click', saveDiaryData);
            
            // 清空所有按钮
            document.getElementById('clearBtn').addEventListener('click', clearAllDiaryData);
            
            // 云端同步按钮
            document.getElementById('cloudSyncBtn').addEventListener('click', () => {
                goToPanel(3); // 切换到云端设置面板
            });
            
            // 上一时辰按钮
            document.getElementById('prevPeriodBtn').addEventListener('click', function() {
                let newIndex = currentPeriodIndex - 1;
                if (newIndex < 0) newIndex = periods.length - 1;
                selectPeriod(newIndex);
            });
            
            // 下一时辰按钮
            document.getElementById('nextPeriodBtn').addEventListener('click', function() {
                let newIndex = currentPeriodIndex + 1;
                if (newIndex >= periods.length) newIndex = 0;
                selectPeriod(newIndex);
            });
            
            // 番茄钟控制
            document.getElementById('startBtn').addEventListener('click', startTimer);
            document.getElementById('pauseBtn').addEventListener('click', pauseTimer);
            document.getElementById('resetBtn').addEventListener('click', resetTimer);
            
            // 番茄钟设置
            document.getElementById('focusTime').addEventListener('change', updateTimerSettings);
            document.getElementById('breakTime').addEventListener('change', updateTimerSettings);
            
            // 标签页切换
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // 更新按钮状态
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 显示对应的内容
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}Tab`).classList.add('active');
                });
            });
            
            // 趋势图控制
            document.querySelectorAll('.trend-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // 更新按钮状态
                    document.querySelectorAll('.trend-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 确定图表类型
                    const period = this.dataset.period || 'week';
                    const type = this.dataset.type || 'all';
                    
                    // 更新图表
                    updateTrendChart(period, type);
                });
            });
            
            // 日历导航
            document.getElementById('prevMonthBtn').addEventListener('click', function() {
                currentCalendarMonth--;
                if (currentCalendarMonth < 0) {
                    currentCalendarMonth = 11;
                    currentCalendarYear--;
                }
                updateCalendar();
            });
            
            document.getElementById('nextMonthBtn').addEventListener('click', function() {
                currentCalendarMonth++;
                if (currentCalendarMonth > 11) {
                    currentCalendarMonth = 0;
                    currentCalendarYear++;
                }
                updateCalendar();
            });
            
            document.getElementById('todayBtn').addEventListener('click', function() {
                currentCalendarMonth = currentDate.getMonth();
                currentCalendarYear = currentDate.getFullYear();
                updateCalendar();
            });
            
            // 加载历史记录
            document.getElementById('loadHistoryBtn').addEventListener('click', function() {
                const historyDate = document.getElementById('historyDate').value;
                if (historyDate) {
                    loadDiaryData(historyDate);
                    showNotification(`已加载 ${historyDate} 的记录`, 'success');
                    
                    // 回到第一个面板
                    goToPanel(0);
                }
            });
            
            // 滑动导航
            document.querySelectorAll('.swipe-dot').forEach((dot, index) => {
                dot.addEventListener('click', () => {
                    goToPanel(index);
                });
            });
            
            // 滑动导航按钮
            document.getElementById('prevPanelBtn').addEventListener('click', () => {
                let newIndex = currentPanelIndex - 1;
                if (newIndex < 0) newIndex = totalPanels - 1;
                goToPanel(newIndex);
            });
            
            document.getElementById('nextPanelBtn').addEventListener('click', () => {
                let newIndex = currentPanelIndex + 1;
                if (newIndex >= totalPanels) newIndex = 0;
                goToPanel(newIndex);
            });
            
            // 数据导入导出按钮
            document.getElementById('exportDataBtn').addEventListener('click', exportAllData);
            document.getElementById('importDataBtn').addEventListener('click', importData);
            document.getElementById('clearAllDataBtn').addEventListener('click', clearAllStoredData);
            
            // 文件导入处理
            document.getElementById('importFileInput').addEventListener('change', handleFileImport);
            
            // 云端同步按钮
            document.getElementById('syncNowBtn').addEventListener('click', syncToCloud);
            document.getElementById('downloadFromCloudBtn').addEventListener('click', downloadFromCloud);
            document.getElementById('testConnectionBtn').addEventListener('click', testCloudConnection);
            document.getElementById('autoSyncToggle').addEventListener('click', toggleAutoSync);
            document.getElementById('saveCloudSettingsBtn').addEventListener('click', saveCloudSettings);
            document.getElementById('clearCloudSettingsBtn').addEventListener('click', clearCloudSettings);
            
            // 云端同步模态框按钮
            document.getElementById('closeCloudSyncModal').addEventListener('click', hideCloudSyncModal);
            document.getElementById('closeCloudSync').addEventListener('click', hideCloudSyncModal);
            document.getElementById('cancelCloudSync').addEventListener('click', function() {
                hideCloudSyncModal();
                showNotification('同步已取消', 'info');
            });
            
            // 自动保存文本输入
            document.querySelectorAll('textarea, select').forEach(element => {
                element.addEventListener('change', function() {
                    // 延迟自动保存当前时辰
                    clearTimeout(window.autoSaveTimeout);
                    window.autoSaveTimeout = setTimeout(() => {
                        saveCurrentPeriod();
                    }, 2000);
                });
            });
            
            // 编辑器自动保存
            document.querySelectorAll('.editor-content').forEach(editor => {
                editor.addEventListener('input', function() {
                    // 延迟自动保存当前时辰
                    clearTimeout(window.autoSaveTimeout);
                    window.autoSaveTimeout = setTimeout(() => {
                        saveEditorContent();
                    }, 2000);
                });
            });
        }
        
        // 格式化日期
        function formatDate(date) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const weekdays = ['日', '一', '二', '三', '四', '五', '六'];
            const weekday = weekdays[date.getDay()];
            
            return `${year}年${month}月${day}日 星期${weekday}`;
        }
    </script>
</body>
</html>